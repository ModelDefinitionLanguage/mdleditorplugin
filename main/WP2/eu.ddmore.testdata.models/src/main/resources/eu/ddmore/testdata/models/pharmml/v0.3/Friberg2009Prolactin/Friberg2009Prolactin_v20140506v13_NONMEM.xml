<?xml version="1.0" encoding="UTF-8"?>
<PharmML xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="http://www.pharmml.org/2013/03/PharmML"
  xsi:schemaLocation="http://www.pharmml.org/2013/03/PharmML http://www.pharmml.org/2013/03/PharmML"
  xmlns:math="http://www.pharmml.org/2013/03/Maths"
  xmlns:ct="http://www.pharmml.org/2013/03/CommonTypes"
  xmlns:ds="http://www.pharmml.org/2013/08/Dataset"
  xmlns:mdef="http://www.pharmml.org/2013/03/ModelDefinition"
  xmlns:mstep="http://www.pharmml.org/2013/03/ModellingSteps"
  xmlns:mml="http://www.pharmml.org/2013/03/PharmML"
  writtenVersion="0.3">
  
  <ct:Name id="i1">Friberg - CPT 2009</ct:Name>
  <ct:Description id="i2">This model is based on the publication:An agonist-antagonist interaction model for prolactin release follwing risperidone and paliperidone treatment 
    Friberg LE, Vermeulen AM, Petersson KJF, and Karlsson MO. CPT 2009; 85(4), 2009. 
    Keywords: Schizophrenia, Antipsychotics, D2-receptor antagonist, dopamine, diurnal rhythm, NONMEM, clinical trials</ct:Description>
  
  
  <!-- independent variable -->
  <IndependentVariable symbId="t"/>
 
  
  <!-- SYMBOL DEFINITION - RESIDUAL ERROR MODEL -->
  <ct:FunctionDefinition symbId="constantErrorModel" symbolType="real">
    <ct:FunctionArgument symbId="a" symbolType="real"/>
    <ct:Definition>
      <ct:SymbRef symbIdRef="a"/>
    </ct:Definition>   
  </ct:FunctionDefinition>

  <ModelDefinition xmlns="http://www.pharmml.org/2013/03/ModelDefinition">
    <VariabilityModel blkId="model" type="parameterVariability">
      <Level symbId="indiv"/>
      <Level symbId="iov1">
        <ParentLevel>
          <ct:SymbRef symbIdRef="indiv"/>
        </ParentLevel>
      </Level>
    </VariabilityModel>
    <VariabilityModel blkId="obsErr" type="residualError">
      <Level symbId="residual"/>
    </VariabilityModel>
    
    
    <!-- BLOCK I part B: COVARIATE MODEL -->
    
    <CovariateModel blkId="c1">
      <Covariate symbId="Pat">
        <Categorical>
          <Category catId="PAT">
            <ct:Name>PAT</ct:Name>
          </Category>
          <Category catId="HV">
            <ct:Name>HV</ct:Name>
          </Category>
        </Categorical>
      </Covariate>
      <Covariate symbId="Sex">
        <Categorical>
          <Category catId="F">
            <ct:Name>Female</ct:Name>
          </Category>
          <Category catId="M">
            <ct:Name>Male</ct:Name>
          </Category>
        </Categorical>
      </Covariate>
      <Covariate symbId="Study">
        <Categorical>
          <Category catId="STUD1">
            <ct:Name>STUD1</ct:Name>
          </Category>
          <Category catId="STUD28">
            <ct:Name>STUD28</ct:Name>
          </Category>
          <Category catId="STUD61">
            <ct:Name>STUD61</ct:Name>
          </Category>
          <Category catId="STUD101">
            <ct:Name>STUD101</ct:Name>
          </Category>
          <Category catId="STUD302">
            <ct:Name>STUD302</ct:Name>
          </Category>
          <Category catId="STUD9005">
            <ct:Name>STUD9005</ct:Name>
          </Category>
        </Categorical>
      </Covariate>
      <Covariate symbId="Occasion">
        <Categorical>
          <Category catId="occ1">
            <ct:Name>1</ct:Name>
          </Category>
          <Category catId="occ2">
            <ct:Name>2</ct:Name>
          </Category>
          <Category catId="occ3">
            <ct:Name>3</ct:Name>
          </Category>
          <Category catId="occ4">
            <ct:Name>4</ct:Name>
          </Category>
        </Categorical>
      </Covariate>
    </CovariateModel>
    
    <!-- BLOCK I part C: PARAMETER MODEL -->    
    
    <ParameterModel blkId="pm1">
      
      <!-- Define the EBEs -->
      <SimpleParameter symbId="VCI"/>      
      <SimpleParameter symbId="CLI"/>   
      <SimpleParameter symbId="VPI"/>
      <SimpleParameter symbId="QI"/>
      <SimpleParameter symbId="KAI"/>      
      <SimpleParameter symbId="FI"/>      
      <SimpleParameter symbId="DURI"/>
      <SimpleParameter symbId="LAGI"/>
      
      <SimpleParameter symbId="D2">
        <ct:Assign>
          <ct:Real>0.5</ct:Real>
        </ct:Assign>
      </SimpleParameter>
      <SimpleParameter symbId="F2">
        <ct:Assign>
          <ct:Real>1</ct:Real>
        </ct:Assign>
      </SimpleParameter>
      
      <SimpleParameter symbId="KDA"/>
      <SimpleParameter symbId="UPDA"/>
      <SimpleParameter symbId="DPHS"/>
      
      <SimpleParameter symbId="PHS1">
        <ct:Assign>
          <math:Equation xmlns:math="http://www.pharmml.org/2013/03/Maths">
            <math:Piecewise>
              <math:Piece>
                <ct:SymbRef symbIdRef="PHS1"/>
                <math:Condition>
                  <math:LogicBinop op="eq">
                    <ct:SymbRef blkIdRef="c1" symbIdRef="Pat"/>
                    <ct:SymbRef blkIdRef="c1" symbIdRef="HV"/>
                  </math:LogicBinop>
                </math:Condition>
              </math:Piece>
              <math:Piece>
                <math:Binop op="plus">
                  <ct:SymbRef symbIdRef="PHS1"/>
                  <ct:SymbRef symbIdRef="DPHS"/>
                </math:Binop>
                <math:Condition>
                  <math:LogicBinop op="eq">
                    <ct:SymbRef blkIdRef="c1" symbIdRef="Pat"/>
                    <ct:SymbRef blkIdRef="c1" symbIdRef="PAT"/>
                  </math:LogicBinop>
                </math:Condition>
              </math:Piece>
            </math:Piecewise>
          </math:Equation>
        </ct:Assign>
      </SimpleParameter>
      
      <SimpleParameter symbId="AMP2"/>
      
      <SimpleParameter symbId="pop_KOUT"/>
      <SimpleParameter symbId="omega_KOUT"/>
      <RandomVariable symbId="eta_KOUT">
        <ct:VariabilityReference>
          <ct:SymbRef blkIdRef="model" symbIdRef="indiv"/>
        </ct:VariabilityReference>
        <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
          <mean>
            <rVal>0</rVal>
          </mean>
          <stddev>
            <var varId="omega_KOUT"/>
          </stddev>
        </NormalDistribution>
      </RandomVariable>
      <IndividualParameter symbId="KOUT">
        <GaussianModel>
          <Transformation>log</Transformation>
          <LinearCovariate>
            <PopulationParameter>
              <ct:Assign>
                <ct:SymbRef symbIdRef="pop_KOUT"/>
              </ct:Assign>
            </PopulationParameter>
          </LinearCovariate>
          <RandomEffects>
            <ct:SymbRef symbIdRef="eta_KOUT"/>
          </RandomEffects>
        </GaussianModel>
      </IndividualParameter>
      
      <SimpleParameter symbId="pop_PRL0">
        <ct:Assign>
          <math:Equation xmlns:math="http://www.pharmml.org/2013/03/Maths">
            <math:Piecewise>
              <math:Piece>
                <ct:SymbRef symbIdRef="pop_PRL0"/>
                <math:Condition>
                  <math:LogicBinop op="eq">
                    <ct:SymbRef blkIdRef="c1" symbIdRef="Pat"/>
                    <ct:SymbRef blkIdRef="c1" symbIdRef="HV"/>
                  </math:LogicBinop>
                </math:Condition>
              </math:Piece>
              <math:Piece>
                <ct:SymbRef symbIdRef="pop_PRL0PATM"/>
                <math:Condition>
                  <math:LogicBinop op="and">
                    <math:LogicBinop op="and">
                      <math:LogicBinop op="eq">
                        <ct:SymbRef blkIdRef="c1" symbIdRef="Pat"/>
                        <ct:SymbRef blkIdRef="c1" symbIdRef="PAT"/>
                      </math:LogicBinop>
                      <math:LogicBinop op="eq">
                        <ct:SymbRef blkIdRef="c1" symbIdRef="Sex"/>
                        <ct:SymbRef blkIdRef="c1" symbIdRef="M"/>
                      </math:LogicBinop>
                    </math:LogicBinop>
                    <math:LogicBinop op="neq">
                      <ct:SymbRef symbIdRef="Study"/>
                      <ct:SymbRef symbIdRef="STUD101"/>
                    </math:LogicBinop>
                  </math:LogicBinop>
                </math:Condition>
              </math:Piece>
              <math:Piece>
                <ct:SymbRef symbIdRef="pop_PRL0PATF"/>
                <math:Condition>
                  <math:LogicBinop op="and">
                    <math:LogicBinop op="and">
                      <math:LogicBinop op="eq">
                        <ct:SymbRef blkIdRef="c1" symbIdRef="Pat"/>
                        <ct:SymbRef blkIdRef="c1" symbIdRef="PAT"/>
                      </math:LogicBinop>
                      <math:LogicBinop op="eq">
                        <ct:SymbRef blkIdRef="c1" symbIdRef="Sex"/>
                        <ct:SymbRef blkIdRef="c1" symbIdRef="F"/>
                      </math:LogicBinop>
                    </math:LogicBinop>
                    <math:LogicBinop op="neq">
                      <ct:SymbRef symbIdRef="Study"/>
                      <ct:SymbRef symbIdRef="STUD101"/>
                    </math:LogicBinop>
                  </math:LogicBinop>
                </math:Condition>
              </math:Piece>
              <math:Piece>
                <ct:SymbRef symbIdRef="pop_PRL0ST101M"/>
                <math:Condition>
                  <math:LogicBinop op="and">
                    <math:LogicBinop op="and">
                      <math:LogicBinop op="eq">
                        <ct:SymbRef blkIdRef="c1" symbIdRef="Pat"/>
                        <ct:SymbRef blkIdRef="c1" symbIdRef="PAT"/>
                      </math:LogicBinop>
                      <math:LogicBinop op="eq">
                        <ct:SymbRef blkIdRef="c1" symbIdRef="Sex"/>
                        <ct:SymbRef blkIdRef="c1" symbIdRef="M"/>
                      </math:LogicBinop>
                    </math:LogicBinop>
                    <math:LogicBinop op="eq">
                      <ct:SymbRef symbIdRef="Study"/>
                      <ct:SymbRef symbIdRef="STUD101"/>
                    </math:LogicBinop>
                  </math:LogicBinop>
                </math:Condition>
              </math:Piece>
              <math:Piece>
                <ct:SymbRef symbIdRef="pop_PRL0ST101F"/>
                <math:Condition>
                  <math:LogicBinop op="and">
                    <math:LogicBinop op="and">
                      <math:LogicBinop op="eq">
                        <ct:SymbRef blkIdRef="c1" symbIdRef="Pat"/>
                        <ct:SymbRef blkIdRef="c1" symbIdRef="PAT"/>
                      </math:LogicBinop>
                      <math:LogicBinop op="eq">
                        <ct:SymbRef blkIdRef="c1" symbIdRef="Sex"/>
                        <ct:SymbRef blkIdRef="c1" symbIdRef="F"/>
                      </math:LogicBinop>
                    </math:LogicBinop>
                    <math:LogicBinop op="eq">
                      <ct:SymbRef symbIdRef="Study"/>
                      <ct:SymbRef symbIdRef="STUD101"/>
                    </math:LogicBinop>
                  </math:LogicBinop>
                </math:Condition>
              </math:Piece>
            </math:Piecewise>
          </math:Equation>
        </ct:Assign>
      </SimpleParameter>
      <SimpleParameter symbId="omega_PRL0"/>
      <SimpleParameter symbId="gamma_PRL0"/>
      <RandomVariable symbId="eta_PRL0">
        <ct:VariabilityReference>
          <ct:SymbRef blkIdRef="model" symbIdRef="indiv"/>
        </ct:VariabilityReference>
        <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
          <mean>
            <rVal>0</rVal>
          </mean>
          <stddev>
            <var varId="omega_PRL0"/>
          </stddev>
        </NormalDistribution>
      </RandomVariable>
      <RandomVariable symbId="kappa_PRL0">
        <ct:VariabilityReference>
          <ct:SymbRef blkIdRef="model" symbIdRef="iov1"/>
        </ct:VariabilityReference>
        <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
          <mean>
            <rVal>0</rVal>
          </mean>
          <stddev>
            <var varId="gamma_PRL0"/>
          </stddev>
        </NormalDistribution>
      </RandomVariable>
      <IndividualParameter symbId="PRL0">
        <GaussianModel>
          <Transformation>log</Transformation>
          <LinearCovariate>
            <PopulationParameter>
              <ct:Assign>
                <ct:SymbRef symbIdRef="pop_PRL0"/>
              </ct:Assign>
            </PopulationParameter>
          </LinearCovariate>
          <RandomEffects>
            <ct:SymbRef xmlns:ct="http://www.pharmml.org/2013/03/CommonTypes" symbIdRef="eta_PRL0"/>
            <ct:SymbRef xmlns:ct="http://www.pharmml.org/2013/03/CommonTypes" symbIdRef="kappa_PRL0"/>
          </RandomEffects>
        </GaussianModel>
      </IndividualParameter>
      
      <SimpleParameter symbId="pop_AMP1"/>
      <SimpleParameter symbId="omega_AMP1"/>
      <RandomVariable symbId="eta_AMP1">
        <ct:VariabilityReference>
          <ct:SymbRef blkIdRef="model" symbIdRef="indiv"/>
        </ct:VariabilityReference>
        <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
          <mean>
            <rVal>0</rVal>
          </mean>
          <stddev>
            <var varId="omega_AMP1"/>
          </stddev>
        </NormalDistribution>
      </RandomVariable>
      <IndividualParameter symbId="AMP1">
        <GaussianModel>
          <Transformation>log</Transformation>
          <LinearCovariate>
            <PopulationParameter>
              <ct:Assign>
                <ct:SymbRef symbIdRef="pop_AMP1"/>
              </ct:Assign>
            </PopulationParameter>
          </LinearCovariate>
          <RandomEffects>
            <ct:SymbRef xmlns:ct="http://www.pharmml.org/2013/03/CommonTypes" symbIdRef="eta_AMP1"/>
          </RandomEffects>
        </GaussianModel>
      </IndividualParameter>
      
      <SimpleParameter symbId="pop_PHS2">
        <ct:Assign>
          <math:Equation xmlns:math="http://www.pharmml.org/2013/03/Maths">
            <math:Piecewise>
              <math:Piece>
                <ct:SymbRef symbIdRef="pop_PHS2"/>
                <math:Condition>
                  <math:LogicBinop op="eq">
                    <ct:SymbRef blkIdRef="c1" symbIdRef="Pat"/>
                    <ct:SymbRef blkIdRef="c1" symbIdRef="HV"/>
                  </math:LogicBinop>
                </math:Condition>
              </math:Piece>
              <math:Piece>
                <math:Binop op="plus">
                  <ct:SymbRef symbIdRef="pop_PHS2"/>
                  <ct:SymbRef symbIdRef="DPHS"/>
                </math:Binop>
                <math:Condition>
                  <math:LogicBinop op="eq">
                    <ct:SymbRef blkIdRef="c1" symbIdRef="Pat"/>
                    <ct:SymbRef blkIdRef="c1" symbIdRef="PAT"/>
                  </math:LogicBinop>
                </math:Condition>
              </math:Piece>
            </math:Piecewise>
          </math:Equation>
        </ct:Assign>
      </SimpleParameter>
      <SimpleParameter symbId="omega_PHS2"/>
      <RandomVariable symbId="eta_PHS2">
        <ct:VariabilityReference>
          <ct:SymbRef blkIdRef="model" symbIdRef="indiv"/>
        </ct:VariabilityReference>
        <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
          <mean>
            <rVal>0</rVal>
          </mean>
          <stddev>
            <var varId="omega_PHS2"/>
          </stddev>
        </NormalDistribution>
      </RandomVariable>
      <IndividualParameter symbId="PHS2">
        <ct:Assign>
          <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
            <Binop op="plus">
              <ct:SymbRef symbIdRef="pop_PHS2"/>
              <ct:SymbRef symbIdRef="eta_PHS2"/>
            </Binop>
          </Equation>
        </ct:Assign>
      </IndividualParameter>
      
      <SimpleParameter symbId="pop_KI"/>
      <SimpleParameter symbId="omega_KI"/>
      <RandomVariable symbId="eta_KI">
        <ct:VariabilityReference>
          <ct:SymbRef blkIdRef="model" symbIdRef="indiv"/>
        </ct:VariabilityReference>
        <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
          <mean>
            <rVal>0</rVal>
          </mean>
          <stddev>
            <var varId="omega_KI"/>
          </stddev>
        </NormalDistribution>
      </RandomVariable>
      <IndividualParameter symbId="KI">
        <GaussianModel>
          <Transformation>log</Transformation>
          <LinearCovariate>
            <PopulationParameter>
              <ct:Assign>
                <ct:SymbRef symbIdRef="pop_KI"/>
              </ct:Assign>
            </PopulationParameter>
          </LinearCovariate>
          <RandomEffects>
            <ct:SymbRef symbIdRef="eta_KI"/>
          </RandomEffects>
        </GaussianModel>
      </IndividualParameter>
      <Correlation>
        <ct:VariabilityReference>
          <ct:SymbRef blkIdRef="model" symbIdRef="indiv"/>
        </ct:VariabilityReference>
        <Pairwise>
          <RandomVariable1>
            <ct:SymbRef symbIdRef="eta_PRL0"/>
          </RandomVariable1>
          <RandomVariable2>
            <ct:SymbRef symbIdRef="eta_KI"/>
          </RandomVariable2>
          <CorrelationCoefficient>
            <ct:SymbRef symbIdRef="rho_PRL0_KI"/>
          </CorrelationCoefficient>
        </Pairwise>
      </Correlation>

    </ParameterModel>

    <!-- BLOCK I part D: STRUCTURAL MODEL -->
    
    <StructuralModel blkId="sm1" id="i6">
      <ct:DerivativeVariable symbId="Ad" symbolType="real">
        <ct:Assign>
          <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
            <Binop op="times">
              <Uniop op="minus">
                <ct:SymbRef blkIdRef="pm1" symbIdRef="KAI"/>
              </Uniop>
              <ct:SymbRef symbIdRef="Ad"/>
            </Binop>
          </Equation>
        </ct:Assign>
        <ct:IndependentVariable>
          <ct:SymbRef symbIdRef="t"/>
        </ct:IndependentVariable>
        <ct:InitialCondition>
          <ct:InitialValue>
            <ct:Assign>
              <ct:Real>0</ct:Real>
            </ct:Assign>
          </ct:InitialValue>        
        </ct:InitialCondition>
        
      </ct:DerivativeVariable>
      <ct:DerivativeVariable symbId="Ac" symbolType="real">
        <ct:Assign>
          <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
            <Binop op="plus">
              <Binop op="minus">
                <Binop op="times">
                  <ct:SymbRef symbIdRef="KAI"/>
                  <ct:SymbRef symbIdRef="Ad"/>
                </Binop>
                <Binop op="times">
                  <Binop op="plus">
                    <Binop op="divide">
                      <ct:SymbRef blkIdRef="pm1" symbIdRef="QI"/>
                      <ct:SymbRef blkIdRef="pm1" symbIdRef="VCI"/>
                    </Binop>
                    <Binop op="divide">
                      <ct:SymbRef blkIdRef="pm1" symbIdRef="CLI"/>
                      <ct:SymbRef blkIdRef="pm1" symbIdRef="VCI"/>
                    </Binop>
                  </Binop>
                  <ct:SymbRef symbIdRef="Ac"/>
                </Binop>
              </Binop>
              <Binop op="times">
                <Binop op="divide">
                  <ct:SymbRef blkIdRef="pm1" symbIdRef="QI"/>
                  <ct:SymbRef blkIdRef="pm1" symbIdRef="VPI"/>
                </Binop>
                <ct:SymbRef symbIdRef="Ap"/>
              </Binop>
            </Binop>
          </Equation>
        </ct:Assign>
        <ct:IndependentVariable>
          <ct:SymbRef symbIdRef="t"/>
        </ct:IndependentVariable>
        <ct:InitialCondition>
          <ct:InitialValue>
            <ct:Assign>
              <ct:Real>0</ct:Real>
            </ct:Assign>
          </ct:InitialValue>
        </ct:InitialCondition>
      </ct:DerivativeVariable>
      
      <ct:DerivativeVariable symbId="Ap" symbolType="real">
        <ct:Assign>
          <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
            <Binop op="minus">
              <Binop op="times">
                <Binop op="divide">
                  <ct:SymbRef blkIdRef="pm1" symbIdRef="QI"/>
                  <ct:SymbRef blkIdRef="pm1" symbIdRef="VCI"/>
                </Binop>
                <ct:SymbRef symbIdRef="Ac"/>
              </Binop>
              <Binop op="times">
                <Binop op="divide">
                  <ct:SymbRef blkIdRef="pm1" symbIdRef="QI"/>
                  <ct:SymbRef blkIdRef="pm1" symbIdRef="VPI"/>
                </Binop>
                <ct:SymbRef symbIdRef="Ap"/>
              </Binop>
            </Binop>
          </Equation>
        </ct:Assign>
        <ct:IndependentVariable>
          <ct:SymbRef symbIdRef="t"/>
        </ct:IndependentVariable>
        <ct:InitialCondition>
          <ct:InitialValue>
            <ct:Assign>
              <ct:Real>0</ct:Real>
            </ct:Assign>
          </ct:InitialValue>
        </ct:InitialCondition>       
      </ct:DerivativeVariable>
      
      <ct:Variable symbolType="real" symbId="CP" id="i18">
        <ct:Assign>
          <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
            <Binop op="divide">
              <Binop op="times">
                <ct:Real>1000</ct:Real>
                <ct:SymbRef symbIdRef="Ac"/>
              </Binop>
              <ct:SymbRef symbIdRef="VCI"/>
            </Binop>
          </Equation>
        </ct:Assign>
      </ct:Variable>
  
      <ct:Variable symbolType="real" symbId="DIU" id="i18">
        <ct:Assign>
          <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
            <Binop op="plus">
              <Binop op="times">
                <ct:SymbRef blkIdRef="pm1" symbIdRef="AMP1"/>
                <Uniop op="cos">
                  <Binop op="divide">
                    <Binop op="times">
                      <Binop op="times">
                        <ct:Real>2</ct:Real>
                        <Constant op="pi"/>
                      </Binop>
                      <Binop op="minus">
                        <ct:SymbRef symbIdRef="t"/>
                        <ct:SymbRef blkIdRef="pm1" symbIdRef="PHS1"/>
                      </Binop>
                    </Binop>
                    <ct:Real>24</ct:Real>
                  </Binop>
                </Uniop>
              </Binop>
              <Binop op="times">
                <ct:SymbRef blkIdRef="pm1" symbIdRef="AMP2"/>
                <Uniop op="cos">
                  <Binop op="divide">
                    <Binop op="times">
                      <Binop op="times">
                        <ct:Real>2</ct:Real>
                        <Constant op="pi"/>
                      </Binop>
                      <Binop op="minus">
                        <ct:SymbRef symbIdRef="t"/>
                        <ct:SymbRef blkIdRef="pm1" symbIdRef="PHS2"/>
                      </Binop>
                    </Binop>
                    <ct:Real>12</ct:Real>
                  </Binop>
                </Uniop>
              </Binop>
            </Binop>
          </Equation>
        </ct:Assign>
      </ct:Variable>
      
      <ct:Variable symbolType="real" symbId="KINB" id="i18">
        <ct:Assign>
          <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
            <Binop op="times">
              <ct:SymbRef symbIdRef="KOUT"/>
              <ct:SymbRef symbIdRef="PRL0"/>
            </Binop>
          </Equation>
        </ct:Assign>
      </ct:Variable>
      
      <ct:Variable symbolType="real" symbId="KINM" id="i18">
        <ct:Assign>
          <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
            <Binop op="times">
              <ct:SymbRef symbIdRef="KINB"/>
              <Binop op="plus">
                <ct:Real>1</ct:Real>
                <ct:Real>10000</ct:Real>
              </Binop>
            </Binop>
          </Equation>
        </ct:Assign>
      </ct:Variable>
      
      <ct:Variable symbolType="real" symbId="AAI" id="i18">
        <ct:Assign>
          <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
            <Piecewise>
              <Piece>
                <ct:Real>1</ct:Real>
                <Condition>
                  <LogicBinop op="eq">
                    <ct:SymbRef symbIdRef="Adp"/>
                    <ct:Int>0</ct:Int>
                  </LogicBinop>
                </Condition>
              </Piece>
              <Piece>
                <Binop op="divide">
                  <ct:SymbRef symbIdRef="Adp"/>
                  <Binop op="plus">
                    <Binop op="plus">
                      <ct:Real>1</ct:Real>
                      <ct:SymbRef symbIdRef="Adp"/>
                    </Binop>
                    <Binop op="divide">
                      <ct:SymbRef blkIdRef="pm1" symbIdRef="CP"/>
                      <ct:SymbRef blkIdRef="pm1" symbIdRef="KI"/>
                    </Binop>
                  </Binop>
                </Binop>
                <Condition>
                  <LogicBinop op="gt">
                    <ct:SymbRef symbIdRef="Adp"/>
                    <ct:Real>0</ct:Real>
                  </LogicBinop>
                </Condition>
              </Piece>
            </Piecewise>
          </Equation>
        </ct:Assign>
      </ct:Variable>
      
      <ct:Variable symbolType="real" symbId="FEED" id="i18">
        <ct:Assign>
          <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
            <Piecewise>
              <Piece>
                <ct:Real>1</ct:Real>
                <Condition>
                  <LogicBinop op="eq">
                    <ct:SymbRef symbIdRef="Apr"/>
                    <ct:Int>0</ct:Int>
                  </LogicBinop>
                </Condition>
              </Piece>
              <Piece>
                <Binop op="power">
                  <Binop op="divide">
                    <ct:SymbRef symbIdRef="Apr"/>
                    <ct:SymbRef blkIdRef="pm1" symbIdRef="PRL0"/>
                  </Binop>
                  <ct:SymbRef blkIdRef="pm1" symbIdRef="UPDA"/>
                </Binop>
                <Condition>
                  <LogicBinop op="gt">
                    <ct:SymbRef symbIdRef="Apr"/>
                    <ct:Real>0</ct:Real>
                  </LogicBinop>
                </Condition>
              </Piece>
            </Piecewise>
          </Equation>
        </ct:Assign>
      </ct:Variable>
      
      <ct:DerivativeVariable symbolType="real" symbId="Apr" id="i5">
        <ct:Assign>
          <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
            <Binop op="minus">
              <Binop op="plus">
                <Binop op="times">
                  <ct:SymbRef symbIdRef="KINM"/>
                  <Binop op="minus">
                    <ct:Real>1</ct:Real>
                    <ct:SymbRef symbIdRef="AAI"/>
                  </Binop>
                </Binop>
                <Binop op="times">
                  <ct:SymbRef symbIdRef="KINB"/>
                  <ct:SymbRef symbIdRef="DIU"/>
                </Binop>
              </Binop>
              <Binop op="times">
                <ct:SymbRef symbIdRef="KOUT"/>
                <ct:SymbRef symbIdRef="Apr"/>
              </Binop>
            </Binop>
          </Equation>
        </ct:Assign>
        <ct:IndependentVariable>
          <ct:SymbRef symbIdRef="t"/>
        </ct:IndependentVariable>
        <ct:InitialCondition>
          <ct:InitialValue>
            <ct:Assign>
              <ct:SymbRef blkIdRef="pm1" symbIdRef="PRL0"/>
            </ct:Assign>
          </ct:InitialValue>
        </ct:InitialCondition>
      </ct:DerivativeVariable>
      
      <ct:DerivativeVariable symbolType="real" symbId="Adp" id="i16">
        <ct:Assign>
          <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
            <Binop op="minus">
              <Binop op="times">
                <Binop op="times">
                  <ct:SymbRef blkIdRef="pm1" symbIdRef="KDA"/>
                  <ct:Real>10000</ct:Real>
                </Binop>
                <ct:SymbRef symbIdRef="FEED"/>
              </Binop>
              <Binop op="times">
                <ct:SymbRef blkIdRef="pm1" symbIdRef="KDA"/>
                <ct:SymbRef symbIdRef="Adp"/>
              </Binop>
            </Binop>
          </Equation>
        </ct:Assign>
        <ct:IndependentVariable>
          <ct:SymbRef symbIdRef="t"/>
        </ct:IndependentVariable>
        <ct:InitialCondition>
          <ct:InitialValue>
            <ct:Assign>
              <ct:Real>10000</ct:Real>
            </ct:Assign>
          </ct:InitialValue>
        </ct:InitialCondition>
      </ct:DerivativeVariable>    
      
    </StructuralModel>
    
    
    <!-- BLOCK I part E: OBSERVATION MODEL -->
    
    <ObservationModel blkId="om1">
      
      <SimpleParameter symbId="a">
        <ct:Assign>
          <math:Equation xmlns:math="http://www.pharmml.org/2013/03/Maths">
            <math:Piecewise>
              <math:Piece>
                <ct:SymbRef symbIdRef="a"/>
                <math:Condition>
                  <math:LogicBinop op="eq">
                    <ct:SymbRef blkIdRef="c1" symbIdRef="Pat"/>
                    <ct:SymbRef blkIdRef="c1" symbIdRef="HV"/>
                  </math:LogicBinop>
                </math:Condition>
              </math:Piece>
              <math:Piece>
                <ct:SymbRef symbIdRef="b"/>
                <math:Condition>
                  <math:LogicBinop op="eq">
                    <ct:SymbRef blkIdRef="c1" symbIdRef="Pat"/>
                    <ct:SymbRef blkIdRef="c1" symbIdRef="PAT"/>
                  </math:LogicBinop>
                </math:Condition>
              </math:Piece>
              <math:Piece>
                <ct:SymbRef symbIdRef="c"/>
                <math:Condition>
                  <math:LogicBinop op="eq">
                    <ct:SymbRef blkIdRef="c1" symbIdRef="Sex"/>
                    <ct:SymbRef blkIdRef="c1" symbIdRef="F"/>
                  </math:LogicBinop>
                </math:Condition>
              </math:Piece>
            </math:Piecewise>
          </math:Equation>
        </ct:Assign>
      </SimpleParameter>
      
      <RandomVariable symbId="eps">
        <ct:VariabilityReference>
          <ct:SymbRef blkIdRef="obsErr" symbIdRef="residual"/>
        </ct:VariabilityReference>
        <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
          <mean>
            <rVal>0</rVal>
          </mean>
          <stddev>
            <prVal>1</prVal>
          </stddev>
        </NormalDistribution>
      </RandomVariable>
      
      <Standard symbId="Apr_obs" id="i9">
        <Transformation>log</Transformation>
        <Output>
          <ct:SymbRef blkIdRef="sm1" symbIdRef="Apr"/>
        </Output>
        <ErrorModel>
          <ct:Assign>
            <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
              <FunctionCall>
                <ct:SymbRef symbIdRef="constantErrorModel"/>
                <FunctionArgument symbId="a">
                  <ct:SymbRef symbIdRef="a"/>
                </FunctionArgument>
              </FunctionCall>
            </Equation>
          </ct:Assign>
        </ErrorModel>
        <ResidualError>
          <ct:SymbRef symbIdRef="eps"/>
        </ResidualError>
      </Standard>
    </ObservationModel>
    
  </ModelDefinition>
  

  <!-- BLOCK II: TRIAL DEFINITION -->

  
  <!-- BLOCK III: MODELLING STEPS -->
  
  <ModellingSteps xmlns="http://www.pharmml.org/2013/03/ModellingSteps">
    

    <!-- NONMEM DATASET -->
    <NONMEMdataSet oid="NMoid">
      <!-- MAPPING -->
      <ColumnMapping>
        <ColumnRef xmlns="http://www.pharmml.org/2013/08/Dataset" columnIdRef="TIME"/>
        <SymbRef xmlns="http://www.pharmml.org/2013/03/CommonTypes" symbIdRef="t"/>
      </ColumnMapping>
      <ColumnMapping>
        <ColumnRef xmlns="http://www.pharmml.org/2013/08/Dataset" columnIdRef="DV"/>
        <ct:SymbRef xmlns:ct="http://www.pharmml.org/2013/03/CommonTypes" blkIdRef="om1" symbIdRef="Apr_obs"/>
      </ColumnMapping>
      <ColumnMapping>
        <ColumnRef xmlns="http://www.pharmml.org/2013/08/Dataset" columnIdRef="SEX"/>
        <ct:SymbRef xmlns:ct="http://www.pharmml.org/2013/03/CommonTypes" blkIdRef="c1" symbIdRef="Sex"/>
      </ColumnMapping>
      <ColumnMapping>
        <ColumnRef xmlns="http://www.pharmml.org/2013/08/Dataset" columnIdRef="NPTR"/>
        <ct:SymbRef xmlns:ct="http://www.pharmml.org/2013/03/CommonTypes" blkIdRef="c1" symbIdRef="Study"/>
      </ColumnMapping>
      <ColumnMapping>
        <ds:ColumnRef columnIdRef="CLR"></ds:ColumnRef>
        <ct:SymbRef blkIdRef="pm1" symbIdRef="CLI"></ct:SymbRef>
      </ColumnMapping>
      <ColumnMapping>
        <ds:ColumnRef columnIdRef="VC"></ds:ColumnRef>
        <ct:SymbRef blkIdRef="pm1" symbIdRef="VCI"></ct:SymbRef>
      </ColumnMapping>
      <ColumnMapping>
        <ds:ColumnRef columnIdRef="VP"></ds:ColumnRef>
        <ct:SymbRef blkIdRef="pm1" symbIdRef="VPI"></ct:SymbRef>
      </ColumnMapping>
      <ColumnMapping>
        <ds:ColumnRef columnIdRef="QB"></ds:ColumnRef>
        <ct:SymbRef blkIdRef="pm1" symbIdRef="QI"></ct:SymbRef>
      </ColumnMapping>
      <ColumnMapping>
        <ds:ColumnRef columnIdRef="KS"></ds:ColumnRef>
        <ct:SymbRef blkIdRef="pm1" symbIdRef="KAI"></ct:SymbRef>
      </ColumnMapping>        
      <ColumnMapping>
        <ColumnRef xmlns="http://www.pharmml.org/2013/08/Dataset" columnIdRef="FR"/>
        <ct:SymbRef blkIdRef="pm1" symbIdRef="FI"/>
      </ColumnMapping>
      <ColumnMapping>
        <ColumnRef xmlns="http://www.pharmml.org/2013/08/Dataset" columnIdRef="DUR"/>
        <ct:SymbRef blkIdRef="pm1" symbIdRef="DURI"/>
      </ColumnMapping>
      <ColumnMapping>
        <ColumnRef xmlns="http://www.pharmml.org/2013/08/Dataset" columnIdRef="ALAG"/>
        <ct:SymbRef blkIdRef="pm1" symbIdRef="LAGI"/>
      </ColumnMapping>
      <!-- dataset -->
      <ds:DataSet>
        <ds:Definition>
          <ds:Column columnId="ID" columnType="id" valueType="id" columnNum="1"></ds:Column>
          <ds:Column columnId="TIME" columnType="idv" valueType="real" columnNum="2"></ds:Column>
          <ds:Column columnId="DV" columnType="dv" valueType="real" columnNum="3"></ds:Column>
          <ds:Column columnId="CMT" columnType="undefined" valueType="int" columnNum="4"></ds:Column>
          <ds:Column columnId="AMT" columnType="dose" valueType="real" columnNum="5"></ds:Column>
          <ds:Column columnId="RATE" columnType="rate" valueType="real" columnNum="6"></ds:Column>
          <ds:Column columnId="EVID" columnType="evid" valueType="int" columnNum="7"></ds:Column>
          <ds:Column columnId="SEX" columnType="covariate" valueType="int" columnNum="8"></ds:Column>
          <ds:Column columnId="CLR" columnType="undefined" valueType="real" columnNum="9"></ds:Column>
          <ds:Column columnId="VC" columnType="undefined" valueType="real" columnNum="10"></ds:Column>
          <ds:Column columnId="VP" columnType="undefined" valueType="real" columnNum="11"></ds:Column>
          <ds:Column columnId="QB" columnType="undefined" valueType="real" columnNum="12"></ds:Column>
          <ds:Column columnId="KS" columnType="undefined" valueType="real" columnNum="13"></ds:Column>
          <ds:Column columnId="FR" columnType="undefined" valueType="real" columnNum="14"></ds:Column>
          <ds:Column columnId="DUR" columnType="undefined" valueType="real" columnNum="15"></ds:Column>
          <ds:Column columnId="ALAG" columnType="undefined" valueType="real" columnNum="16"></ds:Column>
          <ds:Column columnId="NPTR" columnType="covariate" valueType="int" columnNum="17"></ds:Column>
        </ds:Definition>
        <ds:ImportData oid="NMdata">
          <ds:name>sim_imi_occ1_Friberg2009</ds:name>
          <ds:url>sim_imi_occ1_Friberg2009.csv</ds:url>
          <ds:format>CSV</ds:format>
          <ds:delimiter>COMMA</ds:delimiter>
        </ds:ImportData>
      </ds:DataSet>
    </NONMEMdataSet>
    
    
    <!-- ESTIMATION STEP --> 
    <EstimationStep oid="estTask1" id="i10">
      
      <ParametersToEstimate>
        <ParameterEstimation>
          <ct:SymbRef blkIdRef="pm1" symbIdRef="pop_PRL0"/>
          <InitialEstimate>
            <ct:Real>7.67</ct:Real>
          </InitialEstimate>
          <LowerBound>
            <ct:Real>1</ct:Real>
          </LowerBound>
          <UpperBound>
            <ct:Real>15</ct:Real>
          </UpperBound>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef blkIdRef="pm1" symbIdRef="pop_PRL0PATM"/>
          <InitialEstimate>
            <ct:Real>16.1</ct:Real>
          </InitialEstimate>
          <LowerBound>
            <ct:Real>1</ct:Real>
          </LowerBound>
          <UpperBound>
            <ct:Real>30</ct:Real>
          </UpperBound>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef blkIdRef="pm1" symbIdRef="pop_PRL0PATF"/>
          <InitialEstimate>
            <ct:Real>35.2</ct:Real>
          </InitialEstimate>
          <LowerBound>
            <ct:Real>1</ct:Real>
          </LowerBound>
          <UpperBound>
            <ct:Real>40</ct:Real>
          </UpperBound>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef blkIdRef="pm1" symbIdRef="pop_PRL0ST101M"/>
          <InitialEstimate>
            <ct:Real>11.3</ct:Real>
          </InitialEstimate>
          <LowerBound>
            <ct:Real>0</ct:Real>
          </LowerBound>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef blkIdRef="pm1" symbIdRef="pop_PRL0ST101F"/>
          <InitialEstimate>
            <ct:Real>23.2</ct:Real>
          </InitialEstimate>
          <LowerBound>
            <ct:Real>0</ct:Real>
          </LowerBound>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef blkIdRef="pm1" symbIdRef="omega_PRL0"/>
          <InitialEstimate>
            <ct:Real>0.425</ct:Real>
          </InitialEstimate>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef blkIdRef="pm1" symbIdRef="gamma_PRL0"/>
          <InitialEstimate>
            <ct:Real>0.0657</ct:Real>
          </InitialEstimate>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef  blkIdRef="pm1" symbIdRef="pop_KOUT"/>
          <InitialEstimate>
            <ct:Real>0.664</ct:Real>
          </InitialEstimate>
          <LowerBound>
            <ct:Real>0.1</ct:Real>
          </LowerBound>
          <UpperBound>
            <ct:Real>10</ct:Real>
          </UpperBound>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef  blkIdRef="pm1" symbIdRef="omega_KOUT"/>
          <InitialEstimate>
            <ct:Real>0.589</ct:Real>
          </InitialEstimate>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef  blkIdRef="pm1" symbIdRef="pop_AMP1"/>
          <InitialEstimate>
            <ct:Real>0.532</ct:Real>
          </InitialEstimate>
          <LowerBound>
            <ct:Real>-0.75</ct:Real>
          </LowerBound>
          <UpperBound>
            <ct:Real>1.5</ct:Real>
          </UpperBound>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef  blkIdRef="pm1" symbIdRef="omega_AMP1"/>
          <InitialEstimate>
            <ct:Real>0.0558</ct:Real>
          </InitialEstimate>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef  blkIdRef="pm1" symbIdRef="DPHS"/>
          <InitialEstimate>
            <ct:Real>-1.61</ct:Real>
          </InitialEstimate>
          <LowerBound>
            <ct:Real>-5</ct:Real>
          </LowerBound>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef  blkIdRef="pm1" symbIdRef="PHS1"/>
          <InitialEstimate>
            <ct:Real>20.1</ct:Real>
          </InitialEstimate>
          <LowerBound>
            <ct:Real>12</ct:Real>
          </LowerBound>
          <UpperBound>
            <ct:Real>25</ct:Real>
          </UpperBound>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef  blkIdRef="pm1" symbIdRef="AMP2"/>
          <InitialEstimate>
            <ct:Real>-0.314</ct:Real>
          </InitialEstimate>
          <LowerBound>
            <ct:Real>-0.9</ct:Real>
          </LowerBound>
          <UpperBound>
            <ct:Real>0.2</ct:Real>
          </UpperBound>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef  blkIdRef="pm1" symbIdRef="pop_PHS2"/>
          <InitialEstimate>
            <ct:Real>13.7</ct:Real>
          </InitialEstimate>
          <LowerBound>
            <ct:Real>-2</ct:Real>
          </LowerBound>
          <UpperBound>
            <ct:Real>15</ct:Real>
          </UpperBound>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef  blkIdRef="pm1" symbIdRef="omega_PHS2"/>
          <InitialEstimate>
            <ct:Real>1.80</ct:Real>
          </InitialEstimate>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef  blkIdRef="pm1" symbIdRef="pop_KI"/>
          <InitialEstimate>
            <ct:Real>1.96</ct:Real>
          </InitialEstimate>
          <LowerBound>
            <ct:Real>0</ct:Real>
          </LowerBound>
          <UpperBound>
            <ct:Real>100</ct:Real>
          </UpperBound>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef  blkIdRef="pm1" symbIdRef="omega_KI"/>
          <InitialEstimate>
            <ct:Real>1.82</ct:Real>
          </InitialEstimate>
        </ParameterEstimation>          
        <ParameterEstimation>
          <ct:SymbRef  blkIdRef="pm1" symbIdRef="rho_PRL0_KI"/>
          <InitialEstimate>
            <ct:Real>0.86</ct:Real>
          </InitialEstimate>
        </ParameterEstimation> 
        <ParameterEstimation>
          <ct:SymbRef  blkIdRef="pm1" symbIdRef="KDA"/>
          <InitialEstimate>
            <ct:Real>-0.156</ct:Real>
          </InitialEstimate>
          <LowerBound>
            <ct:Real>0.001</ct:Real>
          </LowerBound>
          <UpperBound>
            <ct:Real>50</ct:Real>
          </UpperBound>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef  blkIdRef="pm1" symbIdRef="UPDA"/>
          <InitialEstimate>
            <ct:Real>1.44</ct:Real>
          </InitialEstimate>
          <LowerBound>
            <ct:Real>0.001</ct:Real>
          </LowerBound>
          <UpperBound>
            <ct:Real>10</ct:Real>
          </UpperBound>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef  blkIdRef="om1" symbIdRef="a"/>
          <InitialEstimate>
            <ct:Real>0.0841</ct:Real>
          </InitialEstimate>
          <LowerBound>
            <ct:Real>0</ct:Real>
          </LowerBound>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef  blkIdRef="om1" symbIdRef="b"/>
          <InitialEstimate>
            <ct:Real>0.178</ct:Real>
          </InitialEstimate>
          <LowerBound>
            <ct:Real>0</ct:Real>
          </LowerBound>
        </ParameterEstimation>
        <ParameterEstimation>
          <ct:SymbRef  blkIdRef="om1" symbIdRef="c"/>
          <InitialEstimate>
            <ct:Real>0.326</ct:Real>
          </InitialEstimate>
          <LowerBound>
            <ct:Real>0</ct:Real>
          </LowerBound>
        </ParameterEstimation>
      </ParametersToEstimate>
      
      <Operation order="1" opType="estPop"/>
      <Operation order="2" opType="estIndiv"/>
    
    </EstimationStep>
    
    <StepDependencies>
      <Step>
        <ct:OidRef  oidRef="estTask1"/>
      </Step>
    </StepDependencies>
  
  </ModellingSteps>

</PharmML>
